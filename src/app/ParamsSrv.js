(function () {

    "use strict";
    angular.module('SportsensusApp')
        .factory('ParamsSrv', ParamsSrv);

    // инициализируем сервис
    angular.module('SportsensusApp').run(['ParamsSrv', function(ParamsSrv) {

    }]);

    // angula
    // r.module('SportsensusApp').run(ParamsSrv.init);

    ParamsSrv.$inject = [
        '$rootScope',
        '$http',
        '$q',
        'ApiSrv',
        'ConfigSrv'
    ];


    /**
     * events:
     * ParamsSrv.paramsChanged type newValue oldValue. type in ['demography','consume','regions','region','sport','interest','rooting','involve','image','career]
     */
    function ParamsSrv(
        $rootScope,
        $http,
        $q,
        ApiSrv,
        ConfigSrv
    ) {

        var padamsDefer = $q.defer();

        var parametersNames = ['demography','consume','regions','region','sport','interest','rooting','involve',
            'image','watch','walk','tvhome', 'tvcable','electronics','electronics_exist','gasoften','career',
            'decision', 'timeusage', 'time_week', 'visit_time', 'net','gamingplatform', 'gamingtime','playgrounds'];
        var parameters = {}; // все параметры
        var selected = {}; // выбранные параметры

        //var enums = null;
        /*ApiSrv.getEnums().then(function(data){
            enums = data;
            prepareParams();
            setParamsWatchers();
            padamsDefer.resolve(parameters);
        }, function(){
            padamsDefer.reject();
        });*/

        var translations = null; // {pages, translates}
        ApiSrv.getTranslations().then(function(data){
            translations = data;
            extendTranslations();
            prepareParams();
            setParamsWatchers();
            padamsDefer.resolve(parameters);
        }, function(){
            padamsDefer.reject();
        });

        function extendTranslations(){
            translations.pages.push({
                key: 'playgrounds',
                items:{
                    "hockeyBox40": {
                        "visibility":{
                            "1": [0.02, 0.02, 0.023, 0.042, 0.022, 0.029, 0, 0, 0, 0, 0, 0, 0.022, 0.039, 0.043, 0.038, 0.043, 0.044, 0.04, 0.042, 0, 0, 0, 0, 0, 0, 0.04, 0.044, 0, 0 ],
                            "2": [0.02, 0.02, 0.023, 0.042, 0.022, 0.029, 0, 0, 0, 0, 0, 0, 0.022, 0.039, 0.043, 0.038, 0.043, 0.044, 0.04, 0.042, 0, 0, 0, 0, 0, 0, 0.04, 0.044, 0, 0 ],
                            "3": [0.02, 0.02, 0.023, 0.042, 0.022, 0.029, 0, 0, 0, 0, 0, 0, 0.022, 0.039, 0.043, 0.038, 0.043, 0.044, 0.04, 0.042, 0, 0, 0, 0, 0, 0, 0.04, 0.044, 0, 0 ],
                            "4": [0.02, 0.02, 0.023, 0.042, 0.022, 0.029, 0, 0, 0, 0, 0, 0, 0.022, 0.039, 0.043, 0.038, 0.043, 0.044, 0.04, 0.042, 0, 0, 0, 0, 0, 0, 0.04, 0.044, 0, 0 ],
                            "5": [0.02, 0.02, 0.023, 0.042, 0.022, 0.029, 0, 0, 0, 0, 0, 0, 0.022, 0.039, 0.043, 0.038, 0.043, 0.044, 0.04, 0.042, 0, 0, 0, 0, 0, 0, 0.04, 0.044, 0, 0 ],
                            "6": [0.02, 0.02, 0.023, 0.042, 0.022, 0.029, 0, 0, 0, 0, 0, 0, 0, 0.039, 0.043, 0.038, 0.043, 0.044, 0.04, 0.042, 0, 0, 0, 0, 0, 0, 0, 0.044, 0, 0 ],
                            "7": [0.02, 0.02, 0.023, 0.042, 0.022, 0.029, 0, 0, 0, 0, 0, 0, 0, 0, 0.043, 0.038, 0.043, 0.044, 0.04, 0.042, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
                            "8": [0.02, 0.02, 0.023, 0.042, 0.022, 0.029, 0.04, 0.027, 0, 0, 0, 0, 0, 0, 0.043, 0.038, 0.043, 0.044, 0.04, 0.042, 0.045, 0.043, 0, 0, 0, 0, 0, 0, 0, 0 ],
                            "9": [0.02, 0.02, 0.023, 0.042, 0.022, 0.029, 0.04, 0.027, 0.025, 0, 0, 0, 0, 0, 0.043, 0.038, 0.043, 0.044, 0.04, 0.042, 0.045, 0.043, 0.036, 0, 0, 0, 0, 0, 0.007, 0.002 ],
                            "10": [0.02, 0.02, 0.023, 0.042, 0.022, 0.029, 0.04, 0.027, 0.025, 0, 0, 0, 0, 0, 0.043, 0.038, 0.043, 0.044, 0.04, 0.042, 0.045, 0.043, 0.036, 0, 0, 0, 0, 0, 0.007, 0.002 ],
                            "11": [0, 0.02, 0.023, 0.042, 0.022, 0.029, 0.04, 0.027, 0.025, 0, 0, 0, 0, 0, 0, 0.038, 0.043, 0.044, 0.04, 0.042, 0.045, 0.043, 0.036, 0, 0, 0, 0, 0, 0.007, 0.002 ],
                            "12": [0, 0.02, 0.023, 0.042, 0.022, 0.029, 0.04, 0.027, 0.025, 0, 0, 0, 0, 0, 0, 0.038, 0.043, 0.044, 0.04, 0.042, 0.045, 0.043, 0.036, 0, 0, 0, 0, 0, 0.007, 0.002 ],
                            "13": [0, 0, 0.023, 0.042, 0.022, 0.029, 0.04, 0.027, 0.025, 0.027, 0, 0, 0, 0, 0, 0, 0.043, 0.044, 0.04, 0.042, 0.045, 0.043, 0.036, 0.043, 0, 0, 0, 0, 0.007, 0.002 ],
                            "14": [0, 0, 0, 0, 0.022, 0.029, 0.04, 0.027, 0.025, 0.027, 0.039, 0, 0, 0, 0, 0, 0, 0, 0.04, 0.042, 0.045, 0.043, 0.036, 0.043, 0.044, 0, 0, 0, 0.007, 0.002 ],
                            "15": [0, 0, 0, 0, 0.022, 0.029, 0.04, 0.027, 0.025, 0.027, 0.039, 0.028, 0, 0, 0, 0, 0, 0, 0.04, 0.042, 0.045, 0.043, 0.036, 0.043, 0.044, 0.041, 0, 0, 0.007, 0.002 ],
                            "16": [0, 0, 0, 0, 0.022, 0.029, 0.04, 0.027, 0.025, 0.027, 0.039, 0.028, 0, 0, 0, 0, 0, 0, 0.04, 0.042, 0.045, 0.043, 0.036, 0.043, 0.044, 0.041, 0, 0, 0.007, 0.002 ],
                            "17": [0, 0, 0, 0, 0, 0.029, 0.04, 0.027, 0.025, 0.027, 0.039, 0.028, 0, 0, 0, 0, 0, 0, 0, 0.042, 0.045, 0.043, 0.036, 0.043, 0.044, 0.041, 0, 0, 0.007, 0.002 ],
                            "18": [0, 0, 0, 0, 0, 0.029, 0.04, 0.027, 0.025, 0.027, 0.039, 0.028, 0, 0, 0, 0, 0, 0, 0, 0.042, 0.045, 0.043, 0.036, 0.043, 0.044, 0.041, 0, 0, 0.007, 0.002 ],
                            "19": [0, 0, 0, 0, 0, 0.029, 0.04, 0.027, 0.025, 0.027, 0.039, 0.028, 0, 0, 0, 0, 0, 0, 0, 0.042, 0.045, 0.043, 0.036, 0.043, 0.044, 0.041, 0, 0, 0.007, 0.002 ],
                            "20": [0, 0, 0, 0, 0, 0.029, 0.04, 0.027, 0.025, 0.027, 0.039, 0.028, 0, 0, 0, 0, 0, 0, 0, 0.042, 0.045, 0.043, 0.036, 0.043, 0.044, 0.041, 0, 0, 0.007, 0.002 ],
                            "21": [0, 0, 0, 0, 0, 0.029, 0.04, 0.027, 0.025, 0.027, 0.039, 0.028, 0, 0, 0, 0, 0, 0, 0, 0.042, 0.045, 0.043, 0.036, 0.043, 0.044, 0.041, 0, 0, 0.007, 0.002 ],
                            "22": [0, 0, 0, 0, 0, 0.029, 0.04, 0.027, 0.025, 0.027, 0.039, 0.028, 0, 0, 0, 0, 0, 0, 0, 0.042, 0.045, 0.043, 0.036, 0.043, 0.044, 0.041, 0, 0, 0.007, 0.002 ],
                            "23": [0, 0, 0, 0, 0, 0.029, 0.04, 0.027, 0.025, 0.027, 0.039, 0.028, 0, 0, 0, 0, 0, 0, 0, 0.042, 0.045, 0.043, 0.036, 0.043, 0.044, 0.041, 0, 0, 0.007, 0.002 ],
                            "24": [0, 0, 0, 0, 0, 0.029, 0.04, 0.027, 0.025, 0.027, 0.039, 0.028, 0, 0, 0, 0, 0, 0, 0, 0.042, 0.045, 0.043, 0.036, 0.043, 0.044, 0.041, 0, 0, 0.007, 0.002 ],
                            "25": [0, 0, 0, 0, 0, 0.029, 0.04, 0.027, 0.025, 0.027, 0.039, 0.028, 0, 0, 0, 0, 0, 0, 0, 0.042, 0.045, 0.043, 0.036, 0.043, 0.044, 0.041, 0, 0, 0.007, 0.002 ],
                            "26": [0, 0, 0, 0, 0, 0, 0.04, 0.027, 0.025, 0.027, 0.039, 0.028, 0, 0, 0, 0, 0, 0, 0, 0, 0.045, 0.043, 0.036, 0.043, 0.044, 0.041, 0, 0, 0.007, 0.002 ],
                            "27": [0, 0, 0, 0, 0, 0, 0.04, 0.027, 0.025, 0.027, 0.039, 0.028, 0.022, 0, 0, 0, 0, 0, 0, 0, 0.045, 0.043, 0.036, 0.043, 0.044, 0.041, 0.04, 0, 0.007, 0.002 ],
                            "28": [0, 0, 0, 0, 0, 0, 0, 0.027, 0.025, 0.027, 0.039, 0.028, 0.022, 0, 0, 0, 0, 0, 0, 0, 0, 0.043, 0.036, 0.043, 0.044, 0.041, 0.04, 0, 0.007, 0.002 ],
                            "29": [0.02, 0.02, 0, 0, 0, 0, 0, 0, 0.025, 0.027, 0.039, 0.028, 0.022, 0.039, 0.043, 0.038, 0, 0, 0, 0, 0, 0, 0.036, 0.043, 0.044, 0.041, 0.04, 0.044, 0.007, 0.002 ],
                            "30": [0.02, 0.02, 0, 0, 0, 0, 0, 0, 0.025, 0.027, 0.039, 0.028, 0.022, 0.039, 0.043, 0.038, 0, 0, 0, 0, 0, 0, 0.036, 0.043, 0.044, 0.041, 0.04, 0.044, 0.007, 0.002 ],
                            "31": [0.02, 0.02, 0.023, 0, 0, 0, 0, 0, 0.025, 0.027, 0.039, 0.028, 0.022, 0.039, 0.043, 0.038, 0.043, 0, 0, 0, 0, 0, 0.036, 0.043, 0.044, 0.041, 0.04, 0.044, 0.007, 0.002 ],
                            "32": [0.02, 0.02, 0.023, 0, 0, 0, 0, 0, 0.025, 0.027, 0.039, 0.028, 0.022, 0.039, 0.043, 0.038, 0.043, 0, 0, 0, 0, 0, 0.036, 0.043, 0.044, 0.041, 0.04, 0.044, 0.007, 0.002 ],
                            "33": [0.02, 0.02, 0.023, 0, 0, 0, 0, 0, 0.025, 0.027, 0.039, 0.028, 0.022, 0.039, 0.043, 0.038, 0.043, 0, 0, 0, 0, 0, 0.036, 0.043, 0.044, 0.041, 0.04, 0.044, 0.007, 0.002 ],
                            "34": [0.02, 0.02, 0.023, 0, 0, 0, 0, 0, 0, 0.027, 0.039, 0.028, 0.022, 0.039, 0.043, 0.038, 0.043, 0, 0, 0, 0, 0, 0, 0.043, 0.044, 0.041, 0.04, 0.044, 0, 0 ],
                            "35": [0.02, 0.02, 0.023, 0.042, 0.022, 0.029, 0, 0, 0, 0, 0, 0.028, 0.022, 0.039, 0.043, 0.038, 0.043, 0.044, 0.04, 0.042, 0, 0, 0, 0, 0, 0.041, 0.04, 0.044, 0, 0 ],
                            "36": [0.02, 0.02, 0.023, 0.042, 0.022, 0.029, 0, 0, 0, 0, 0, 0.028, 0.022, 0.039, 0.043, 0.038, 0.043, 0.044, 0.04, 0.042, 0, 0, 0, 0, 0, 0.041, 0.04, 0.044, 0, 0 ],
                            "37": [0.02, 0.02, 0.023, 0.042, 0.022, 0.029, 0, 0, 0, 0, 0, 0, 0.022, 0.039, 0.043, 0.038, 0.043, 0.044, 0.04, 0.042, 0, 0, 0, 0, 0, 0, 0.04, 0.044, 0, 0 ],
                            "38": [0.02, 0.02, 0.023, 0.042, 0.022, 0.029, 0, 0, 0, 0, 0, 0, 0.022, 0.039, 0.043, 0.038, 0.043, 0.044, 0.04, 0.042, 0, 0, 0, 0, 0, 0, 0.04, 0.044, 0, 0 ],
                            "39": [0.02, 0.02, 0.023, 0.042, 0.022, 0.029, 0, 0, 0, 0, 0, 0, 0.022, 0.039, 0.043, 0.038, 0.043, 0.044, 0.04, 0.042, 0, 0, 0, 0, 0, 0, 0.04, 0.044, 0, 0 ],
                            "40": [0.02, 0.02, 0.023, 0.042, 0.022, 0.029, 0, 0, 0, 0, 0, 0, 0.022, 0.039, 0.043, 0.038, 0.043, 0.044, 0.04, 0.042, 0, 0, 0, 0, 0, 0, 0.04, 0.044, 0, 0 ]
                        },
                        "statistics": []
                    },
                    "hockeyBox32": {
                        "visibility":{
                            "1": [0.02, 0.02, 0.023, 0.042, 0.022, 0.029, 0, 0, 0, 0, 0, 0, 0.022, 0.039, 0.043, 0.038, 0.043, 0.044, 0.04, 0.042, 0, 0, 0, 0, 0, 0, 0.04, 0.044, 0, 0 ],
                            "2": [0.02, 0.02, 0.023, 0.042, 0.022, 0.029, 0, 0, 0, 0, 0, 0, 0.022, 0.039, 0.043, 0.038, 0.043, 0.044, 0.04, 0.042, 0, 0, 0, 0, 0, 0, 0.04, 0.044, 0, 0 ],
                            "3": [0.02, 0.02, 0.023, 0.042, 0.022, 0.029, 0, 0, 0, 0, 0, 0, 0.022, 0.039, 0.043, 0.038, 0.043, 0.044, 0.04, 0.042, 0, 0, 0, 0, 0, 0, 0.04, 0.044, 0, 0 ],
                            "4": [0.02, 0.02, 0.023, 0.042, 0.022, 0.029, 0, 0, 0, 0, 0, 0, 0.022, 0.039, 0.043, 0.038, 0.043, 0.044, 0.04, 0.042, 0, 0, 0, 0, 0, 0, 0.04, 0.044, 0, 0 ],
                            "5": [0.02, 0.02, 0.023, 0.042, 0.022, 0.029, 0, 0, 0, 0, 0, 0, 0, 0, 0.043, 0.038, 0.043, 0.044, 0.04, 0.042, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
                            "6": [0.02, 0.02, 0.023, 0.042, 0.022, 0.029, 0.04, 0.027, 0, 0, 0, 0, 0, 0, 0.043, 0.038, 0.043, 0.044, 0.04, 0.042, 0.045, 0.043, 0, 0, 0, 0, 0, 0, 0, 0 ],
                            "7": [0.02, 0.02, 0.023, 0.042, 0.022, 0.029, 0.04, 0.027, 0.025, 0, 0, 0, 0, 0, 0.043, 0.038, 0.043, 0.044, 0.04, 0.042, 0.045, 0.043, 0.036, 0, 0, 0, 0, 0, 0.007, 0.002 ],
                            "8": [0.02, 0.02, 0.023, 0.042, 0.022, 0.029, 0.04, 0.027, 0.025, 0, 0, 0, 0, 0, 0.043, 0.038, 0.043, 0.044, 0.04, 0.042, 0.045, 0.043, 0.036, 0, 0, 0, 0, 0, 0.007, 0.002 ],
                            "9": [0, 0.02, 0.023, 0.042, 0.022, 0.029, 0.04, 0.027, 0.025, 0, 0, 0, 0, 0, 0, 0.038, 0.043, 0.044, 0.04, 0.042, 0.045, 0.043, 0.036, 0, 0, 0, 0, 0, 0.007, 0.002 ],
                            "10": [0, 0.02, 0.023, 0.042, 0.022, 0.029, 0.04, 0.027, 0.025, 0, 0, 0, 0, 0, 0, 0.038, 0.043, 0.044, 0.04, 0.042, 0.045, 0.043, 0.036, 0, 0, 0, 0, 0, 0.007, 0.002 ],
                            "11": [0, 0, 0.023, 0.042, 0.022, 0.029, 0.04, 0.027, 0.025, 0.027, 0, 0, 0, 0, 0, 0, 0.043, 0.044, 0.04, 0.042, 0.045, 0.043, 0.036, 0.043, 0, 0, 0, 0, 0.007, 0.002 ],
                            "12": [0, 0, 0, 0, 0.022, 0.029, 0.04, 0.027, 0.025, 0.027, 0.039, 0, 0, 0, 0, 0, 0, 0, 0.04, 0.042, 0.045, 0.043, 0.036, 0.043, 0.044, 0, 0, 0, 0.007, 0.002 ],
                            "13": [0, 0, 0, 0, 0, 0.029, 0.04, 0.027, 0.025, 0.027, 0.039, 0.028, 0, 0, 0, 0, 0, 0, 0, 0.042, 0.045, 0.043, 0.036, 0.043, 0.044, 0.041, 0, 0, 0.007, 0.002 ],
                            "14": [0, 0, 0, 0, 0, 0.029, 0.04, 0.027, 0.025, 0.027, 0.039, 0.028, 0, 0, 0, 0, 0, 0, 0, 0.042, 0.045, 0.043, 0.036, 0.043, 0.044, 0.041, 0, 0, 0.007, 0.002 ],
                            "15": [0, 0, 0, 0, 0, 0.029, 0.04, 0.027, 0.025, 0.027, 0.039, 0.028, 0, 0, 0, 0, 0, 0, 0, 0.042, 0.045, 0.043, 0.036, 0.043, 0.044, 0.041, 0, 0, 0.007, 0.002 ],
                            "16": [0, 0, 0, 0, 0, 0.029, 0.04, 0.027, 0.025, 0.027, 0.039, 0.028, 0, 0, 0, 0, 0, 0, 0, 0.042, 0.045, 0.043, 0.036, 0.043, 0.044, 0.041, 0, 0, 0.007, 0.002 ],
                            "17": [0, 0, 0, 0, 0, 0.029, 0.04, 0.027, 0.025, 0.027, 0.039, 0.028, 0, 0, 0, 0, 0, 0, 0, 0.042, 0.045, 0.043, 0.036, 0.043, 0.044, 0.041, 0, 0, 0.007, 0.002 ],
                            "18": [0, 0, 0, 0, 0, 0.029, 0.04, 0.027, 0.025, 0.027, 0.039, 0.028, 0, 0, 0, 0, 0, 0, 0, 0.042, 0.045, 0.043, 0.036, 0.043, 0.044, 0.041, 0, 0, 0.007, 0.002 ],
                            "19": [0, 0, 0, 0, 0, 0.029, 0.04, 0.027, 0.025, 0.027, 0.039, 0.028, 0, 0, 0, 0, 0, 0, 0, 0.042, 0.045, 0.043, 0.036, 0.043, 0.044, 0.041, 0, 0, 0.007, 0.002 ],
                            "20": [0, 0, 0, 0, 0, 0.029, 0.04, 0.027, 0.025, 0.027, 0.039, 0.028, 0, 0, 0, 0, 0, 0, 0, 0.042, 0.045, 0.043, 0.036, 0.043, 0.044, 0.041, 0, 0, 0.007, 0.002 ],
                            "21": [0, 0, 0, 0, 0, 0, 0.04, 0.027, 0.025, 0.027, 0.039, 0.028, 0.022, 0, 0, 0, 0, 0, 0, 0, 0.045, 0.043, 0.036, 0.043, 0.044, 0.041, 0.04, 0, 0.007, 0.002 ],
                            "22": [0, 0, 0, 0, 0, 0, 0, 0.027, 0.025, 0.027, 0.039, 0.028, 0.022, 0, 0, 0, 0, 0, 0, 0, 0, 0.043, 0.036, 0.043, 0.044, 0.041, 0.04, 0, 0.007, 0.002 ],
                            "23": [0.02, 0.02, 0, 0, 0, 0, 0, 0, 0.025, 0.027, 0.039, 0.028, 0.022, 0.039, 0.043, 0.038, 0, 0, 0, 0, 0, 0, 0.036, 0.043, 0.044, 0.041, 0.04, 0.044, 0.007, 0.002 ],
                            "24": [0.02, 0.02, 0, 0, 0, 0, 0, 0, 0.025, 0.027, 0.039, 0.028, 0.022, 0.039, 0.043, 0.038, 0, 0, 0, 0, 0, 0, 0.036, 0.043, 0.044, 0.041, 0.04, 0.044, 0.007, 0.002 ],
                            "25": [0.02, 0.02, 0.023, 0, 0, 0, 0, 0, 0.025, 0.027, 0.039, 0.028, 0.022, 0.039, 0.043, 0.038, 0.043, 0, 0, 0, 0, 0, 0.036, 0.043, 0.044, 0.041, 0.04, 0.044, 0.007, 0.002 ],
                            "26": [0.02, 0.02, 0.023, 0, 0, 0, 0, 0, 0.025, 0.027, 0.039, 0.028, 0.022, 0.039, 0.043, 0.038, 0.043, 0, 0, 0, 0, 0, 0.036, 0.043, 0.044, 0.041, 0.04, 0.044, 0.007, 0.002 ],
                            "27": [0.02, 0.02, 0.023, 0, 0, 0, 0, 0, 0.025, 0.027, 0.039, 0.028, 0.022, 0.039, 0.043, 0.038, 0.043, 0, 0, 0, 0, 0, 0.036, 0.043, 0.044, 0.041, 0.04, 0.044, 0.007, 0.002 ],
                            "28": [0.02, 0.02, 0.023, 0, 0, 0, 0, 0, 0, 0.027, 0.039, 0.028, 0.022, 0.039, 0.043, 0.038, 0.043, 0, 0, 0, 0, 0, 0, 0.043, 0.044, 0.041, 0.04, 0.044, 0, 0 ],
                            "29": [0.02, 0.02, 0.023, 0.042, 0.022, 0.029, 0, 0, 0, 0, 0, 0, 0.022, 0.039, 0.043, 0.038, 0.043, 0.044, 0.04, 0.042, 0, 0, 0, 0, 0, 0, 0.04, 0.044, 0, 0 ],
                            "30": [0.02, 0.02, 0.023, 0.042, 0.022, 0.029, 0, 0, 0, 0, 0, 0, 0.022, 0.039, 0.043, 0.038, 0.043, 0.044, 0.04, 0.042, 0, 0, 0, 0, 0, 0, 0.04, 0.044, 0, 0 ],
                            "31": [0.02, 0.02, 0.023, 0.042, 0.022, 0.029, 0, 0, 0, 0, 0, 0, 0.022, 0.039, 0.043, 0.038, 0.043, 0.044, 0.04, 0.042, 0, 0, 0, 0, 0, 0, 0.04, 0.044, 0, 0 ],
                            "32": [0.02, 0.02, 0.023, 0.042, 0.022, 0.029, 0, 0, 0, 0, 0, 0, 0.022, 0.039, 0.043, 0.038, 0.043, 0.044, 0.04, 0.042, 0, 0, 0, 0, 0, 0, 0.04, 0.044, 0, 0 ]
                        },
                        "statistics": [{
                            "league": "КХЛ",
                            "season": "2015/16",
                            "data": {
                                "А": {
                                    "TVR":1.54,
                                    "OTS":3553.86,
                                    "offline":6.5
                                },
                                "В": {
                                    "TVR":1.54,
                                    "OTS":3331.86,
                                    "offline":6.5
                                },
                                "С": {
                                    "TVR":1.54,
                                    "OTS":3023.86,
                                    "offline":6.5
                                },
                                "D": {
                                    "TVR":1.54,
                                    "OTS":3023.86,
                                    "offline":6.5
                                },
                                "E": {
                                    "TVR":1.54,
                                    "OTS":3331.86,
                                    "offline":6.5
                                },
                                "F": {
                                    "TVR":1.51,
                                    "OTS":3266.96,
                                    "offline":6.5
                                },
                                "8": {
                                    "TVR":0.53,
                                    "OTS":1040.68,
                                    "offline":5.2
                                },
                                "9": {
                                    "TVR":0.92,
                                    "OTS":1990.46,
                                    "offline":5.3
                                },
                                "10": {
                                    "TVR":1.34,
                                    "OTS":2899.15,
                                    "offline":5.1
                                },
                                "11": {
                                    "TVR":1.46,
                                    "OTS":2858.78,
                                    "offline":4.6
                                },
                                "12": {
                                    "TVR":1.31,
                                    "OTS":2534.25,
                                    "offline":4.3
                                },
                                "13": {
                                    "TVR":1.19,
                                    "OTS":2274.62,
                                    "offline":4.2
                                },
                                "14": {
                                    "TVR":1.22,
                                    "OTS":2339.53,
                                    "offline":4.5
                                },
                                "15": {
                                    "TVR":1.01,
                                    "OTS":1885.18,
                                    "offline":4.6
                                },
                                "16": {
                                    "TVR":0.89,
                                    "OTS":1825.56,
                                    "offline":4.7
                                },
                                "17": {
                                    "TVR":0.89,
                                    "OTS":1825.56,
                                    "offline":4.7
                                },
                                "18": {
                                    "TVR":1.01,
                                    "OTS":1885.18,
                                    "offline":4.6
                                },
                                "19": {
                                    "TVR":1.22,
                                    "OTS":2339.53,
                                    "offline":4.5
                                },
                                "20": {
                                    "TVR":1.19,
                                    "OTS":2274.62,
                                    "offline":4.2
                                },
                                "21": {
                                    "TVR":1.31,
                                    "OTS":2534.25,
                                    "offline":4.3
                                },
                                "22": {
                                    "TVR":1.46,
                                    "OTS":2858.78,
                                    "offline":4.6
                                },
                                "23": {
                                    "TVR":1.34,
                                    "OTS":2599.15,
                                    "offline":5.1
                                },
                                "24": {
                                    "TVR":0.92,
                                    "OTS":1990.46,
                                    "offline":5.3
                                },
                                "25": {
                                    "TVR":0.53,
                                    "OTS":1040.68,
                                    "offline":5.2
                                },
                                "1": {
                                    "offline":4.7
                                },
                                "2": {
                                    "offline":4.6
                                },
                                "3": {
                                    "offline":4.5
                                },
                                "4": {
                                    "offline":4.2
                                },
                                "5": {
                                    "offline":4.3
                                },
                                "6": {
                                    "offline":4.6
                                },
                                "7": {
                                    "offline":5.1
                                },
                                "26": {
                                    "offline":5.1
                                },
                                "27": {
                                    "offline":4.6
                                },
                                "28": {
                                    "offline":4.3
                                },
                                "29": {
                                    "offline":4.2
                                },
                                "30": {
                                    "offline":4.5
                                },
                                "31": {
                                    "offline":4.6
                                },
                                "32": {
                                    "offline":4.7
                                }
                            }
                        },{
                            "league": "ВХЛ",
                            "season": "2015/16",
                            "data": {
                                "А": {
                                    "offline":2.05
                                },
                                "В": {
                                    "offline":2.05
                                },
                                "С": {
                                    "offline":2.05
                                },
                                "D": {
                                    "offline":2.05
                                },
                                "E": {
                                    "offline":2.05
                                },
                                "F": {
                                    "offline":2.05
                                },
                                "8": {
                                    "offline":1.61
                                },
                                "9": {
                                    "offline":1.64
                                },
                                "10": {
                                    "offline":1.58
                                },
                                "11": {
                                    "offline":1.43
                                },
                                "12": {
                                    "offline":1.33
                                },
                                "13": {
                                    "offline":1.3
                                },
                                "14": {
                                    "offline":1.4
                                },
                                "15": {
                                    "offline":1.43
                                },
                                "16": {
                                    "offline":1.46
                                },
                                "17": {
                                    "offline":1.46
                                },
                                "18": {
                                    "offline":1.43
                                },
                                "19": {
                                    "offline":1.4
                                },
                                "20": {
                                    "offline":1.3
                                },
                                "21": {
                                    "offline":1.33
                                },
                                "22": {
                                    "offline":1.43
                                },
                                "23": {
                                    "offline":1.58
                                },
                                "24": {
                                    "offline":1.64
                                },
                                "25": {
                                    "offline":1.61
                                },
                                "1": {
                                    "offline":1.46
                                },
                                "2": {
                                    "offline":1.43
                                },
                                "3": {
                                    "offline":1.4
                                },
                                "4": {
                                    "offline":1.3
                                },
                                "5": {
                                    "offline":1.33
                                },
                                "6": {
                                    "offline":1.43
                                },
                                "7": {
                                    "offline":1.58
                                },
                                "26": {
                                    "offline":1.58
                                },
                                "27": {
                                    "offline":1.43
                                },
                                "28": {
                                    "offline":1.33
                                },
                                "29": {
                                    "offline":1.3
                                },
                                "30": {
                                    "offline":1.4
                                },
                                "31": {
                                    "offline":1.43
                                },
                                "32": {
                                    "offline":1.46
                                }
                            }
                        },{
                            "league": "МХЛ",
                            "season": "2015/16",
                            "data":{
                                "А": {
                                    "offline":0.74
                                },
                                "В": {
                                    "offline":0.74
                                },
                                "С": {
                                    "offline":0.74
                                },
                                "D": {
                                    "offline":0.74
                                },
                                "E": {
                                    "offline":0.74
                                },
                                "F": {
                                    "offline":0.74
                                },
                                "8": {
                                    "offline":0.59
                                },
                                "9": {
                                    "offline":0.6
                                },
                                "10": {
                                    "offline":0.58
                                },
                                "11": {
                                    "offline":0.52
                                },
                                "12": {
                                    "offline":0.49
                                },
                                "13": {
                                    "offline":0.48
                                },
                                "14": {
                                    "offline":0.51
                                },
                                "15": {
                                    "offline":0.52
                                },
                                "16": {
                                    "offline":0.54
                                },
                                "17": {
                                    "offline":0.54
                                },
                                "18": {
                                    "offline":0.52
                                },
                                "19": {
                                    "offline":0.51
                                },
                                "20": {
                                    "offline":0.48
                                },
                                "21": {
                                    "offline":0.49
                                },
                                "22": {
                                    "offline":0.52
                                },
                                "23": {
                                    "offline":0.58
                                },
                                "24": {
                                    "offline":0.6
                                },
                                "25": {
                                    "offline":0.59
                                },
                                "1": {
                                    "offline":0.54
                                },
                                "2": {
                                    "offline":0.52
                                },
                                "3": {
                                    "offline":0.51
                                },
                                "4": {
                                    "offline":0.48
                                },
                                "5": {
                                    "offline":0.49
                                },
                                "6": {
                                    "offline":0.52
                                },
                                "7": {
                                    "offline":0.58
                                },
                                "26": {
                                    "offline":0.58
                                },
                                "27": {
                                    "offline":0.52
                                },
                                "28": {
                                    "offline":0.49
                                },
                                "29": {
                                    "offline":0.48
                                },
                                "30": {
                                    "offline":0.51
                                },
                                "31": {
                                    "offline":0.52
                                },
                                "32": {
                                    "offline":0.54
                                }
                            }
                        }]
                    },
                    "footballField": {
                        "visibility":{},
                        "statistics": [{
                            "league": "РПФЛ",
                            "season": "2015/16",
                            "data": {
                                "A1": {
                                    "TVR":1.46,
                                    "OTS":2097.87,
                                    "offline":6.30
                                },
                                "В1": {
                                    "TVR":1.31,
                                    "OTS":1888.09,
                                    "offline":7.87
                                },
                                "С1": {
                                    "TVR":1.24,
                                    "OTS":1783.19,
                                    "offline":7.35
                                },
                                "D1": {
                                    "TVR":1.34,
                                    "OTS":1930.04,
                                    "offline":5.77
                                },
                                "E1": {
                                    "TVR":1.34,
                                    "OTS":1930.04,
                                    "offline":5.25
                                },
                                "F1": {
                                    "TVR":1.26,
                                    "OTS":1804.17,
                                    "offline":5.25
                                },
                                "G1": {
                                    "TVR":1.14,
                                    "OTS":1636.34,
                                    "offline":5.25
                                },
                                "H": {
                                    "TVR":1.46,
                                    "OTS":2065.87,
                                    "offline":10.50
                                },
                                "В2": {
                                    "offline":7.87
                                },
                                "С2": {
                                    "offline":7.35
                                },
                                "D2": {
                                    "offline":5.77
                                },
                                "E2": {
                                    "offline":5.25
                                },
                                "F2": {
                                    "offline":5.25
                                },
                                "G2": {
                                    "offline":5.25
                                }
                            }
                        },{
                            "league": "ФНЛ",
                            "season": "2015/16",
                            "data": {
                                "А1": {
                                    "offline":1.86
                                },
                                "В1": {
                                    "offline":2.32
                                },
                                "С1": {
                                    "offline":2.17
                                },
                                "D1": {
                                    "offline":5.77
                                },
                                "E1": {
                                    "offline":5.25
                                },
                                "F1": {
                                    "offline":5.25
                                },
                                "G1": {
                                    "offline":5.25
                                },
                                "H": {
                                    "offline":3.1
                                },
                                "В2": {
                                    "offline":2.32
                                },
                                "С2": {
                                    "offline":2.17
                                },
                                "D2": {
                                    "offline":5.77
                                },
                                "E2": {
                                    "offline":5.25
                                },
                                "F2": {
                                    "offline":5.25
                                },
                                "G2": {
                                    "offline":5.25
                                }
                            }
                        }]
                    },
                    "basketballCourt": {
                        "visibility":{},
                        "statistics": [{
                            "league": "ЕЛ ВТБ",
                            "season": "2015/16",
                            "data": {
                                "А": {
                                    "TVR":0.16,
                                    "OTS":729.39,
                                    "offline":1.31
                                },
                                "Б": {
                                    "TVR":0.16,
                                    "OTS":729.39,
                                    "offline":1.31
                                },
                                "В": {
                                    "TVR":0.16,
                                    "OTS":711.35,
                                    "offline":1.21
                                },
                                "Г": {
                                    "TVR":0.13,
                                    "OTS":607.83,
                                    "offline":1.21
                                },
                                "1": {
                                    "TVR":	0.04,
                                    "OTS":162.09,
                                    "offline":1.12
                                },
                                "2": {
                                    "TVR":	0.04,
                                    "OTS":162.09,
                                    "offline":1.87
                                },
                                "3": {
                                    "TVR":	0.15,
                                    "OTS":675.28,
                                    "offline":1.87
                                },
                                "4": {
                                    "TVR":	0.15,
                                    "OTS":675.28,
                                    "offline":1.22
                                },
                                "5": {
                                    "TVR":	0.14,
                                    "OTS":652.73,
                                    "offline":1.22
                                },
                                "6": {
                                    "TVR":	0.13,
                                    "OTS":598.61,
                                    "offline":1.12
                                }
                            }
                        }]
                    }
                }
            });

        }


        // подписка на изменение параметров, для перезапроса count
        function setParamsWatchers(){

        }

        function prepareParams() {

            function isNumber(n) {
                return !isNaN(parseFloat(n)) && isFinite(n);
            }

           /* (function update(items){
                items.forEach(function(item){
                    //items.some(function(item){
                    //if (item.id && item.id == id){
                    var id;
                    if (item.key)
                        id = item.key;
                    if (item.id && !isNumber(item.id)){
                        item.key = item.id;
                        if (id !== undefined)
                            item.id = id;
                        else
                            delete item.id;
                    }
                    if (item.lists instanceof Array){
                        update(item.lists);
                    }
                });
            })(translations.pages);*/

            function getElement(key){
                function recFind(items){
                    var finded;
                    items.some(function(item){
                        //if (item.id && item.id == id){
                        if (item.key && item.key == key){
                            finded = item;
                        } else if (item.lists instanceof Array){
                            finded = recFind(item.lists);
                        }
                        return !!finded;
                    });
                    return finded;
                }
                
                var item = recFind(translations.pages);
                if (!item) return;
                //recFillTranslations(item); // TODO убрать, когда будет переделан формат выдачи
                return item;
                
                // translations.translates = {}
            }

            parametersNames.forEach(function(type){
                parameters[type] = getElement(type);
                $rootScope.$watch(function(){return parameters[type]; }, function(newValue, oldValue){
                    selected[type] = getSelectedParamsRec(newValue);

                    $rootScope.$broadcast('ParamsSrv.paramsChanged', type, selected[type]);

                    if (['demography','consume','regions'].indexOf(type) >= 0){
                        ApiSrv.getCount(getSelectedAudience());
                    }
                }, true);
            });

            
            // проставляем спортам клубы
            parameters.sport.lists.forEach(function(item){
                var clubsObj = item.lists.filter(function(child){return child.key == 'clubs';});
                if (clubsObj.length && clubsObj[0].lists && clubsObj[0].lists.length) 
                    item.clubs = clubsObj[0].lists;
                else item.clubs = [];

                var playground;
                if (item.key == 'football')
                    playground = {type: 'footballField'};
                else if (item.key == 'hockey')
                    playground = {type: 'hockeyBox32'};

                if (playground)
                    item.clubs.forEach(function(club){
                        club.playgrounds = [angular.extend({
                            //"type": "hockeyBox", //(footballField, hockeyBox, basketballCourt, boxingRing, carTrack1, carTrack3...)
                            "stadium": "Стадион", // название стадиона
                            "city": "Город", // город
                            "capacity": + Math.round(Math.random() * 1000)*100, // вместимость
                            "matchCount": 10, // кол-во матчей
                            "tvMatchCount": 10, // кол-во матчей
                            "occupancy": Math.round(Math.random()*100)/100 // процент заполняемости
                        }, playground)];
                    });
            });

            // обрабатываем площадки
            parameters.playgrounds.lists = [];




            var colorGenerator = d3.scale.category10();
            parametersNames.forEach(function(type){
            //['sport','interest','involve','watch','walk'].forEach(function(type){
                parameters[type].lists.forEach(function(item){
                    var id = item.id;
                    id = Number.parseInt(id) % 10;
                    if(!Number.isNaN(id)) {
                        item.chartColor = colorGenerator(id);
                        //console.log(id + ' ' + typeof(id) + ' ' + item.chartColor);
                    }
                });
            });
            parameters.region.lists.forEach(function(item){
                item.chartColor = '#777777';
            })

        }


        function getSelectedParamsRec(item){
            if (item.lists && item.lists.some(function(subitem){return !subitem.lists; })){ // терминальный лист (age, clubs)
                var selectedA = item.lists.filter(function(subitem){return subitem.selected; })
                    .map(function(subitem){return subitem.id});
                if (selectedA.length){
                    return selectedA.length ? selectedA : undefined;
                }
            } else {
                var res = {};
                // проходим по дочерним, только если текущий не отмечен, как выбранный
                if (item.selected !== false && item.interested !== false) {
                    /*item.lists && */item.lists.forEach(function (subitem) {
                        if (!subitem.key) return;
                        var subitemList = getSelectedParamsRec(subitem);
                        if (subitemList) {
                            res[subitem.key] = subitemList;
                        } //else res[subitem.id] = []; //  TODO comment this line
                    });
                }
                if (item.interested) // хардкодим для спорта
                    res.interested = true;
                return Object.keys(res).length ? res : undefined;
            }
        }

        function getSelectedParams(itemName){
            //return getSelectedParamsRec(parameters[itemName]);
            //return selected[itemName];
            if (itemName)
                return selected[itemName];
            else 
                return selected;
        }

        function getSelectedAudience(){
            // return {
            //     demography: getSelectedParams('demography'),
            //     regions: getSelectedParams('regions'),
            //     consume: getSelectedParams('consume')
            // };
            var regions = selected['regions'];
            return {
                demography: selected['demography'],
                // regions: selected['regions'],
                regions: regions,// ? {region:regions} : undefined,
                consume: selected['consume']
            };

            
        }

        // function getSelectedSports(){
        //     return getSelectedParamsRec(parameters.sport);
        // }
        //
        // function getSelectedInterest(){
        //     // return {
        //     //     sport: getSelectedParamsRec(parameters.sport),
        //     //     interest: getSelectedParamsRec(parameters.interest)
        //     // }
        //     return getSelectedParamsRec(parameters.interest);
        // }
        //
        // function getSelectedInterest(){
        //
        // }


        function getSelectedDemographyCaption(){
            var demography =parameters.demography;
            var results = [];
            demography.lists.forEach(function(list){
                var selected = list.lists.filter(function(sublist){
                   return sublist.selected;
                }).map(function(sublist){
                    return sublist.name;
                }).join(', ');
                if (selected)
                    results.push({
                        name: list.name,
                        data: selected
                    });
            });

            var result = results.map(function(obj){
                return obj.name + ': ' + obj.data;
            }).join('<br>');
            if (result)
                result = 'Профиль болельщика: <br>' + result;
            return result;
        }


        function getSelectedSportCaption(includeEmptySports){
            var sport = parameters.sport;
            var results = [];
            sport.lists.forEach(function(list){
                //var interestedObj = list.lists.filter(function(child){return child.id == 'clubs';});
                if (!list.interested) return;
                //var clubsObj = list.lists.filter(function(child){return child.id == 'clubs';});

                var selected = list.clubs.length && list.clubs.filter(function(sublist){
                //var selected = clubsObj.length && clubsObj[0].lists.filter(function(sublist){
                    return sublist.selected;
                }).map(function(sublist){
                    return sublist.name;
                }).join(', ');
                if (selected)
                    results.push({
                        name: list.name,
                        data: selected
                    });
                else if (includeEmptySports){
                    results.push({
                        name: list.name
                    });
                }
            });

            var result = results.map(function(obj){
                return obj.name + (obj.data ? ': ' + obj.data : '');
            }).join('<br>');
            if (result)
                result = 'Профиль спорта: <br>' + result;
            return result;
        }

        function getParams(){
            return padamsDefer.promise;
        }


        var me = {
            getParams: getParams,
            getSelectedParams: getSelectedParams,
            getSelectedAudience: getSelectedAudience,

            getSelectedDemographyCaption: getSelectedDemographyCaption,
            getSelectedSportCaption: getSelectedSportCaption

            //getSelectedAudience: getSelectedAudience,
            //getSelectedSports: getSelectedSports,
            

            // getDemography: function(){return parameters.demography;},
            // getConsume: function(){return parameters.consume;},
            // getSport: function(){return parameters.sport;},
            // getInterest: function(){return parameters.interest;},
            // getRooting: function(){return parameters.rooting;},
            // getInvolve: function(){return parameters.involve;},
            // getImage: function(){return parameters.image;}
        };


        return me;
    }
}());